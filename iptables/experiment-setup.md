# 实验环境准备

本节将会介绍后文的实验环境准备过程。

你也可以跳过实操部分，所有的实验都会有相关的截图。但是或许你想要验证/复现一下实验？

## 购置云服务器

第一步，随便找一个云服务商（国内三大某某云、某某云以及某某云，国外的v某云，a某云等都是可以的）买一台服务器。注意，**不要使用已有的服务器，更不要使用处于生产环境的服务器进行实验**，因为修改Iptables会*一不小心*就搞砸了，导致后续的流量无法进入。此时往往很难恢复，需要重置OS。

操作系统推荐使用Ubuntu，版本选最新的就行(22.04之类的)，Centos已经停止维护啦。

当然，如果你有树莓派什么的，也可以拿来用，好处就是，玩坏了也可以通过直连显示器。

另外，不要选**包年包月**。要选“按照时间付费”的，与其重置OS，不如直接换一台新的更直接。

此外，请注意还需要一个公网IP（方便你ssh进去），也允许公网流量访问。

## 关闭云服务商的防火墙

Iptables本身就是一个防火墙，而大部分的云服务商也会给我们提供一个防火墙，可能称作:
1. 安全组（网络层）；
2. WAF（应用层）。

此时我们选择关闭云服务商提供的防火墙，或者将设置允许流量全部通过。

在这里稍微提一下，云服务商的安全组和我们的Iptables有什么区别？他们虽然都是处理IP数据报，但是云服务商的安全组是由云服务商的设备来处理的。这种设备一般都是硬件设备，并且消耗的资源也是该硬件设备的资源。定制化的硬件设备一般比软件设备更快。而Iptables首先是一个软件防火墙，并且它消耗的是实实在在的自己服务器上的资源。

假设有一个攻击者疯狂DDos服务器的8888端口，而我们现在要禁用这个端口。使用安全组的话，服务器根本感受不到有IP报文传达。但如果使用Iptables的话，说不准就会消耗大量的服务器资源（因为该报文实实在在地来到了服务器中）。

## 关掉OS自带的防火墙+启用Iptables

本步骤可能针对不同云服务商提供的不同OS镜像有所区别，一般来说Iptables是启用的，OS默认的防火墙也是关闭的。但是也说不准，需要自行检查一下。


## 总结

OK，上述步骤已经完成了所有准备了。

你可以试试使用命令`iptables --list`来看看是否安装成功。由于是临时的服务器，我建议后面的内容都使用root运行，玩坏了换一台新的服务器就好（并且即使是生产环境，你也需要root权限来操作iptables）。
